# Production Deployment Checklist

## Before Deployment

### 1. Environment Configuration (.env file)
- [ ] Set `NODE_ENV=production`
- [ ] Update `MONGODB_URI` to production MongoDB server
- [ ] Generate new `JWT_SECRET` (run: `node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"`)
- [ ] Generate new `FASTAPI_SHARED_SECRET` (run: `node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"`)
- [ ] Get new `GOOGLE_API_KEY` with domain restrictions from https://console.cloud.google.com/apis/credentials
- [ ] Update `FASTAPI_BOT_URL` to `https://yourdomain.com/bot` or `https://yourdomain.com:8000`
- [ ] Update `CORS_ORIGIN` to `https://yourdomain.com`
- [ ] Update `MONGO_URI`, `UPDATER_MONGODB_URI`, `DEFAULT_DATABASE_URI_BASE` to production MongoDB

### 2. Build Frontend
- [ ] Run `cd admin-frontend && npm install && npm run build`
- [ ] Verify build folder exists: `admin-frontend/build/`

### 3. Upload to Server
- [ ] Upload entire project to `/var/www/rag-chatbot` (or your chosen directory)
- [ ] Ensure `.env` file is uploaded with production values

## Deployment Steps

### 4. Server Setup
- [ ] Install Node.js 16+ (`curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash - && sudo apt install -y nodejs`)
- [ ] Install Python 3.8+ (`sudo apt install -y python3 python3-pip python3-venv`)
- [ ] Install Nginx (`sudo apt install -y nginx`)
- [ ] Install PM2 (`sudo npm install -g pm2`)
- [ ] Install Certbot (`sudo apt install -y certbot python3-certbot-nginx`)

### 5. Run Deployment Script
- [ ] Navigate to project: `cd /var/www/rag-chatbot`
- [ ] Make script executable: `chmod +x deployment/setup.sh`
- [ ] Run: `./deployment/setup.sh`
- [ ] Or run manual deployment: `chmod +x deployment/deploy.sh && sudo ./deployment/deploy.sh`

### 6. Configure Nginx
- [ ] Edit nginx config: Replace `yourdomain.com` with your actual domain
- [ ] Copy config: `sudo cp deployment/nginx.conf /etc/nginx/sites-available/rag-chatbot`
- [ ] Enable site: `sudo ln -s /etc/nginx/sites-available/rag-chatbot /etc/nginx/sites-enabled/`
- [ ] Test config: `sudo nginx -t`
- [ ] Reload Nginx: `sudo systemctl reload nginx`

### 7. Setup SSL/HTTPS
- [ ] Run certbot: `sudo certbot --nginx -d yourdomain.com`
- [ ] Verify HTTPS works: Visit `https://yourdomain.com`

### 8. Configure Firewall
- [ ] Allow HTTP: `sudo ufw allow 80/tcp`
- [ ] Allow HTTPS: `sudo ufw allow 443/tcp`
- [ ] Allow SSH: `sudo ufw allow 22/tcp`
- [ ] Block internal ports: `sudo ufw deny 5000/tcp && sudo ufw deny 8000/tcp`
- [ ] Enable firewall: `sudo ufw enable`

## Verification

### 9. Test Deployment
- [ ] Frontend loads: `https://yourdomain.com`
- [ ] Backend health: `https://yourdomain.com/api/health`
- [ ] Bot health: `https://yourdomain.com/bot/health`
- [ ] Login works on admin dashboard
- [ ] Widget script accessible: `https://yourdomain.com/ragChatWidget.js`
- [ ] Test chat functionality
- [ ] Test lead capture

### 10. Monitor Services
- [ ] Check backend: `pm2 status`
- [ ] Check bot: `sudo systemctl status rag-bot`
- [ ] Check Nginx: `sudo systemctl status nginx`
- [ ] View backend logs: `pm2 logs rag-backend`
- [ ] View bot logs: `sudo journalctl -u rag-bot -f`

## Post-Deployment

### 11. Security
- [ ] Verify new secrets are in use (check logs for no warnings)
- [ ] Verify MongoDB authentication is enabled
- [ ] Verify CORS is restricted to your domain (not *)
- [ ] Verify firewall is active: `sudo ufw status`
- [ ] Test SSL certificate: `https://www.ssllabs.com/ssltest/`

### 12. Monitoring & Maintenance
- [ ] Setup database backups (see DEPLOYMENT.md)
- [ ] Configure PM2 auto-start: `pm2 startup && pm2 save`
- [ ] Test SSL auto-renewal: `sudo certbot renew --dry-run`
- [ ] Setup log rotation for application logs
- [ ] Configure uptime monitoring (optional)

### 13. Documentation
- [ ] Document your domain and server details
- [ ] Save MongoDB connection strings securely
- [ ] Document admin credentials
- [ ] Share widget embedding code with team

## Emergency Contacts & Recovery

### Important Commands
- Restart backend: `pm2 restart rag-backend`
- Restart bot: `sudo systemctl restart rag-bot`
- Reload Nginx: `sudo systemctl reload nginx`
- View all logs: `pm2 logs && sudo journalctl -u rag-bot -f`

### Rollback
- [ ] Keep backup of previous working `.env`
- [ ] Keep backup of MongoDB data
- [ ] Document rollback procedure

---

## Notes

Date deployed: ________________
Domain: ________________
Server IP: ________________
MongoDB: [ ] Atlas [ ] Self-hosted
SSL expires: ________________

---

For detailed instructions, see DEPLOYMENT.md
